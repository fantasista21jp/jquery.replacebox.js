!function($){$.fn.replacebox=function(configs){var defaults={appendTo:null,zIndex:999,handleUp:".up",handleDown:".down",handleOff:!0,speed:500,easing:"swing",checkFunc:function(){return!0},beforeFunc:null,afterFunc:null,sortable:!1,sortableOption:{},sortableCheckFunc:function(){return!0},sortableBeforeFunc:null,sortableAfterFunc:null},$replacebox=this;if("object"!=typeof $replacebox||1!==$replacebox.length)return this;var $replacechild,$replaceboxes=[];if(configs){if("string"==typeof configs){if(configs.match(/^_/))return this;try{eval(configs)()}catch(e){"console"in window&&console.log(e)}return this}configs=$.extend(defaults,configs)}else configs=defaults;function _set(){($replacechild=configs.appendTo&&"object"==typeof configs.appendTo&&0<configs.appendTo.length?configs.appendTo:$replacebox.children(configs.appendTo)).each(function(_i){var $box=$(this),$up=$(configs.handleUp,$box),$down=$(configs.handleDown,$box);0===_i&&configs.handleOff?$up.css("visibility","hidden"):$up.css("visibility",""),$up.unbind("click").click(function(){return _move("up",_i),!1}),_i>=$replacechild.length-1&&configs.handleOff?$down.css("visibility","hidden"):$down.css("visibility",""),$down.unbind("click").click(function(){return _move("down",_i),!1}),$replaceboxes.push($box)}),!0===configs.sortable&&_sortable(),enable()}function _move(action,_i){if(!0===_getStatus()){var $to,$from=$replaceboxes[_i],index=$replacechild.index($from);if(0!==$from.length){switch(action){case"up":if(0===index)return;$to=$($replacechild.get(index-1));break;case"down":if(index>=$replaceboxes.length-1)return;$to=$($replacechild.get(index+1));break;default:return}if(disable(),!0===configs.checkFunc($from,$to,$replacechild,action)){$.isFunction(configs.beforeFunc)&&configs.beforeFunc($from,$to,$replacechild,action);var position_before_from=$from.position(),position_before_to=$to.position(),$clone_from=$from.clone(!0).appendTo($replacebox),$clone_to=$to.clone(!0).appendTo($replacebox),$move_from=$clone_from.clone(!0).replaceAll($to).css("visibility","hidden"),$move_to=$clone_to.clone(!0).replaceAll($from).css("visibility","hidden"),position_after_from=$move_from.position(),position_after_to=$move_to.position();$clone_from.css({position:"absolute",top:position_before_from.top,left:position_before_from.left,zIndex:configs.zIndex+1}),$clone_to.css({position:"absolute",top:position_before_to.top,left:position_before_to.left,zIndex:configs.zIndex});var moved_from_flg=!1,moved_to_flg=!1;$clone_from.animate({top:position_after_from.top,left:position_after_from.left},configs.speed,configs.easing,function(){(moved_from_flg=!0)===moved_to_flg&&(moved_from_flg=!1,_show($clone_from,$clone_to,$move_from,$move_to,action))}),$clone_to.animate({top:position_after_to.top,left:position_after_to.left},configs.speed,configs.easing,function(){(moved_to_flg=!0)===moved_from_flg&&(moved_to_flg=!1,_show($clone_from,$clone_to,$move_from,$move_to,action))})}else enable()}}}function _show($clone_from,$clone_to,$move_from,$move_to,action){$clone_from.remove(),$clone_to.remove(),$move_from.css("visibility",""),$move_to.css("visibility",""),refresh(),$.isFunction(configs.afterFunc)&&configs.afterFunc($move_from,$move_to,$replacechild,action)}function _sortable(){configs.sortableOption=$.extend(configs.sortableOption,{items:$replacechild,start:function(event,ui){$.isFunction(configs.sortableBeforeFunc)&&configs.sortableBeforeFunc(event,ui)},update:function(event,ui){!1!==configs.sortableCheckFunc(event,ui)||$replacebox.sortable("cancel")},stop:function(event,ui){refresh(),$.isFunction(configs.sortableAfterFunc)&&configs.sortableAfterFunc(event,ui)},disabled:!1}),$replacebox.sortable(configs.sortableOption),$replacebox.sortable("option","handle")?$($replacebox.sortable("option","handle"),$replacebox).disableSelection():$replacebox.disableSelection()}function _getStatus(){return $.data($replacebox.get(0),"replacebox-enabled")}function _getConfigs(){return $.data($replacebox.get(0),"replacebox-configs")}function enable(){$.data($replacebox.get(0),"replacebox-enabled",!0),!0===configs.sortable&&$replacebox.sortable({disabled:!1})}function disable(){$.data($replacebox.get(0),"replacebox-enabled",!1),!0===configs.sortable&&$replacebox.sortable({disabled:!0})}function refresh(){"string"==typeof configs&&(configs=_getConfigs()),null!==configs&&(void 0!==$replacebox.selector&&($replacebox=$($replacebox.selector)),$replaceboxes=[],_set())}function destroy(){var configs=_getConfigs(),org_position=$.data($replacebox.get(0),"replacebox-position");null!==configs&&($replacebox.removeData("replacebox-configs").removeData("replacebox-enabled").removeData("replacebox-position"),!1!==org_position&&$replacebox.css("position",org_position),$replacebox.each(function(_i){var $box=$(this),$up=$(configs.handleUp,$box),$down=$(configs.handleDown,$box);$up.unbind("click"),$down.unbind("click")}),!0===configs.sortable&&$replacebox.sortable("destroy"))}return $.data($replacebox.get(0),"replacebox-position",!1),$replacebox.css("position")&&"static"!=$replacebox.css("position")||($.data($replacebox.get(0),"replacebox-position",!!$replacebox.css("position")&&$replacebox.css("position")),$replacebox.css("position","relative")),$.data($replacebox.get(0),"replacebox-configs",configs),disable(),_set(),this}}(jQuery);